# MapReduce的过程

MapReduce分为Map、Shuffle、Reduce三个阶段



## Map阶段

1. input：读取文件，对输入的文件进行分片处理，每个分片对应一个map任务
2. map：使用编写好的map函数，对数据进行处理

## Shuffle阶段

1. 分区：将数据标记好分区，把数据发送到环形缓冲区（默认100MB），达到80%时超时溢写
2. 排序：溢写发生前对数据进行排序，使用快排，按照key的索引进行字典排序；溢写产生大量文件时需要对溢写文件进行归并排序
3. combine：对溢写的文件也可以进行combine操作，但只能是汇总，将文件按照分区存储到磁盘
4. 分组：进入reduce阶段前对数据进行汇总，形成一个集合

## Reduce阶段

1. 每个Reduce拉取Map端对应分区的数据，拉取后先存在内存中，内存不够了再存储在磁盘中。拉取完所有数据后采用归并排序将内存和磁盘中的数据进行排序
2. 自定义reduce逻辑进行数据聚合操作
3. 输出数据到HDFS

